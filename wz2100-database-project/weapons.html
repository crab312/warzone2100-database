<!DOCTYPE html>
<html xmlns="http://www.w3.org/1999/xhtml">

<head>
    <script src="scripts/jquery-2.0.3.js"></script>
    <script src="scripts/jquery-ui-1.10.3.custom/js/jquery-ui-1.10.3.custom.js"></script>
    <script src="scripts/jquery.blockUI.js"></script>
    <link href="Styles/MyCustomStyles.css" rel="stylesheet" />

    <link href="scripts/jquery.jqGrid-4.5.2/css/ui.jqgrid.css" rel="stylesheet" />
    <script src="scripts/jquery.jqGrid-4.5.2/js/jquery.jqGrid.src.js"></script>
    <script type="text/javascript" src="scripts/jquery.jqGrid-4.5.2/js/i18n/grid.locale-en.js"></script>
    <script src="scripts/jquery.blockUI.js"></script>

    <script src="scripts/MyCustomScripts2.js"></script>
    <script src="scripts/common_objects.js"></script>
    <script src="scripts/designer_functions.js"></script>
    <script src="scripts/research_functions.js"></script>

    <script src="scripts/properties_desription.js"></script>

    <title>Warzone 2100 Guide • Weapons </title>
    

<script>

var player = 0;
var res_time = 600;

var res_time;
$(function () {

    InitDataObjects();

    $("#tabs_left").tabs();
    $("#tabs_left").tabs("option", "active", 0);

    $('#tabs_left ul:first li:eq(0) a').click(null, function (event) {
        url_pushState('');
    });

    $('#tabs_left ul:first li:eq(1) a').click(null, function (event) {
        DrawDetailsTab_Init();
    });


    $('#tabs_left ul:first li:eq(2) a').click(null, function (event) {
        OpenDamageModifiers();
    });

    //if (localStorage["weapons_research_state_seconds"] == undefined) {
    //    localStorage["weapons_research_state_seconds"] = 600;
    //}

    //var res_time = localStorage["weapons_research_state_seconds"];
    //if (res_time == undefined) {
    //    return;
    //}

    ShowLoading('tabs_left');
    LoadAllObjects(function () {
        DoResearchAll(player_all_researched, true, function () {

            DrawResearchSlider("research_slider",
                res_time,
                function (value) {
                    DoResearch(value, player, function () {
                        res_time = value;
                        $('#loadable_weapon_lists').html('');
                        DrawWeaponList();
                    });
                });
            DoResearch(res_time, player, function () {
                DrawWeaponList();
                SelectContentByURLData();
            });
        });
        HideLoading('tabs_left');
    });

});

$(window).on("popstate", function (event) {
    /* Chrome, Opera, Firefox - page load / forward/backward */
    /* IE - forward/backward
    event.originalEvent.state == null when onpopstate triggered in Chrome/Firefox
    */
    if (event.originalEvent.state) {  //this called also on PAGE FIRST LOAD
        console.log('onpopstate triggered');
        SelectContentByURLData();
    }
});

function SelectContentByURLData() {
    if (getUrlVars()["details_id"] != undefined) {
        DrawDetailsTab_Init(getUrlVars()["details_id"]);
    } else if (getUrlVars()["damageModifiers"] != undefined)
    {
        OpenDamageModifiers();
    }
    else {
        $("#tabs_left").tabs("option", "active", 0);
    }
}



function OpenDamageModifiers() {

    if (getUrlVars()["damageModifiers"] == undefined) {
        url_pushState('?damageModifiers=1');
    }
    $("#tabs_left").tabs("option", "active", 2);
    var html = "";
    html += '<div class="ui-widget-header ui-corner-top" style="padding: 5px;"><span lang="en">Propulsion Damage Modifiers</span><span lang="ru">Модификаторы урона по типам ходовой</span></div><div id="propulsion_modifiers" class="ui-widget-content ui-corner-bottom"></div>';

    html += '<div class="ui-widget-header ui-corner-top"  style="padding: 5px; margin-top:10px"><span lang="en">Structure Damage Modifiers</span><span lang="ru">Модификаторы урона по типам построек</span></div><div id="structure_modifiers"></div>';
    $("#left-tabs-2").html(html);

    LoadDataObject(StructureModifiers, function () {
        LoadDataObject(PropulsionModifiers, function () {
            DrawGrid(PropulsionModifiers, "propulsion_modifiers", null, 600);
            DrawGrid(StructureModifiers, "structure_modifiers", null, 600);
        });
    });
}

function IsAviableWeapon(weapon) {
    if (weapon.designable == undefined) {/* Check Weapon designable */
        return false;
    }
    if (ResearchedComponents[player_all_researched][weapon.grid_id] == undefined)/* Check Weapon can be researched */ {
        return false;
    }
    return true;
}

var weap_modifiers_str;

function DrawWeaponList() {

   // DoResearch(res_time, player, function () {
    FillPropModifierHash();
        $("#tank_weapons").html('');
        $("#cyborg_weapons").html('');
        $("#vtol_weapons").html('');
        $("#other_weapons").html('');
        var tank_weapons = DrawSection_type2_html("tank_weapons", "<span lang='en'>Tank Weapons</span><span lang='ru'>Танковые орудия</span>");
        var cyborg_weapons = DrawSection_type2_html("cyborg_weapons", "<span lang='en'>Cyborg Weapons</span><span lang='ru'>Орудия киборгов</span>");
        var vtol_weapons = DrawSection_type2_html("vtol_weapons", "<span lang='en'>VTOL Weapons</span><span lang='ru'>Орудия СВВП (VTOL)</span>");
        var other_weapons = DrawSection_type2_html("other_weapons", "<span lang='en'>Other Weapons</span><span lang='ru'>Другие орудия</span>");

        /* Researchable weapons */
        var collected_weapons = {};
        /* Tank weapons */
        {
            var func_tank_weapons = function (weapon) {
                if (!IsAviableWeapon(weapon)) return false;
                var abils = Weapon_GetAbilities(weapon);
                if (abils.VTOLWeapon || abils.CyborgWeapon) {/* Check Weapon not VTOL, not Cyborg */
                    return false;
                }
                collected_weapons[weapon.grid_id] = 1;
                return true;
            };
            var elem = DrawSection_type1_html(tank_weapons.attr('id'), "");
            elem.append('\
                <span lang="en">\
                    <span>Tank weapons are split into sections by the chosen "research line". Each section contains a list of weapons which use the same upgrades, e.g. when you research machinegun damage you increase the damage of all weapons in the MACHINE GUN section.<br/>Click on a weapon to see it\'s detailed view.</span>\
                </span>\
                <span lang="ru">\
                    <span>Танковые орудия разделены по группам по типу линии исследований. Орудия в одной линии исследований используют одни и те же улучшения, например, когда вы исследует повышение урона для Пулемета, то все орудия из секции "Пулеметы"(MACHINE GUN) получают это улучшение.<br/>Кликните на орудие чтобы просмотреть детальную информацию</span>\
                    </span>\
                \
                ');
            DrawWeaponLines(tank_weapons.attr('id'), func_tank_weapons);
        }

        /* Cyborgs Weapons */
        {
            var func_cyborgs_weapons = function (weapon) {
                if (ResearchedComponents[player_all_researched][weapon.grid_id] == undefined)/* Check Weapon can be researched */ {
                    return false;
                }
                var abils = Weapon_GetAbilities(weapon);
                if (!abils.CyborgWeapon) {/* Check Weapon is cyborg weapon */
                    return false;
                }
                collected_weapons[weapon.grid_id] = 1;
                return true;
            };
            var elem = DrawSection_type1_html(cyborg_weapons.attr('id'), "");
            DrawWeapons(elem.attr('id'), null, func_cyborgs_weapons);
        }

        /* VTOL Weapons */
        {
            var func_vtol_weapons_bombs = function (weapon) {
                if (!IsAviableWeapon(weapon)) return false;
                if (!Weapon_GetAbilities(weapon).VTOLWeapon) {/* Check Weapon is VTOL-Weapon */
                    return false;
                }
                if (weapon.weaponEffect != "ARTILLERY ROUND") {
                    return false;
                }
                collected_weapons[weapon.grid_id] = 1;
                return true;
            };
            var func_vtol_weapons_aa = function (weapon) {
                if (!IsAviableWeapon) return false;
                var abils = Weapon_GetAbilities(weapon);
                if (!abils.VTOLWeapon || !(abils.CanHitVtols && abils.CannotHitGround)) {/* Check Weapon is VTOL-Weapon */
                    return false;
                }
                collected_weapons[weapon.grid_id] = 1;
                return true;
            };
            var func_vtol_weapons = function (weapon) {
                if (!IsAviableWeapon(weapon)) return false;
                if (!Weapon_GetAbilities(weapon).VTOLWeapon) {/* Check Weapon is VTOL-Weapon */
                    return false;
                }
                if (collected_weapons[weapon.grid_id] != undefined) {
                    return false;//this case to skip VTOL-bombs
                }
                collected_weapons[weapon.grid_id] = 1;
                return true;
            };
            var elem1 = DrawSection_type1_html(vtol_weapons.attr('id'), "<span lang='en'>Bombs</span><span lang='ru'>Бомбы</span>");
            DrawWeapons(elem1.attr('id'), null, func_vtol_weapons_bombs, VTOL_cols);
            var elem2 = DrawSection_type1_html(vtol_weapons.attr('id'), "<span lang='en'>Interceptors (Air-to-Air weapons)</span><span lang='ru'>Перехватчики (орудия типа Воздух-Воздух)</span>");
            DrawWeapons(elem2.attr('id'), null, func_vtol_weapons_aa, VTOL_cols);
            var elem3 = DrawSection_type1_html(vtol_weapons.attr('id'), "<span lang='en'>Other VTOL Weapons</span><span lang='ru'>Прочие СВВП-орудия (VTOL)</span>");
            DrawWeapons(elem3.attr('id'), null, func_vtol_weapons, VTOL_cols);
        }

        /* Other weapons */
        {
            var building_weapons = {};
            {
                /* Collect weapons used for buildings */
                for (var i = 0; i < Structures.loaded_data.length; i++) {
                    if (Structures.loaded_data[i].weapons != undefined) {
                        if (ResearchedComponents[player_all_researched][Structures.loaded_data[i].grid_id] == undefined) {
                            //skip structures which cannot be researched
                            continue;
                        }
                        var struc_weaps = Structures.loaded_data[i].weapons.split(',');
                        for (var e = 0 ; e < struc_weaps.length; e++) {
                            building_weapons[struc_weaps[e]] = 1;
                        }
                    }
                }
            }
            var func_other_weapons = function (weapon) {
                if (collected_weapons[weapon.grid_id] != undefined) { // skip weapons which was listed already
                    return false;
                }

                if (building_weapons[weapon.grid_id] == undefined && ResearchedComponents[player_all_researched][weapon.grid_id] == undefined) {
                    return false; //skip non-researchable weapons which also not used on buildings
                }

                collected_weapons[weapon.grid_id] = 1;
                return true;
            };
            var elem = DrawSection_type1_html(other_weapons.attr('id'), "");
            DrawWeapons(elem.attr('id'), null, func_other_weapons);
        }
    //});
}


function FillPropModifierHash()
{
    weap_modifiers_str = {};
    for(var mdf in PropulsionModifiers.loaded_data_hash)
    {
        var m = PropulsionModifiers.loaded_data_hash[mdf];
        var str = "";
        for (var prop_type in PropulsionType.loaded_data_hash)
        {
            var val = m[prop_type] == undefined ? ' - ' : m[prop_type];
            str = str + prop_type + ":" + val + "%, ";
        }
        weap_modifiers_str[mdf] = str;
    }
}

function DrawWeaponLines(container_id, weapon_filer_function) {

    var WeapLines = {};
    var WeapLines_array = [];
    for(var weap_id in Weapons.loaded_data_hash)
    {
        var res_comp_item = ResearchedComponents[player_all_researched][weap_id];
        var weapon = Weapons.loaded_data_hash[weap_id];
        if (!weapon_filer_function(weapon)) {
            continue;
        }
        if(res_comp_item == undefined)
        {
            continue;
        }

        var weapSubClass = weapon.weaponSubClass;
        if(weapSubClass == undefined)
        {
            continue;
        }

        weap_line = WeapLines[weapSubClass];
        if(weap_line == undefined)
        {
            weap_line = {};
            weap_line.weaponSubClass = weapSubClass;
            weap_line.min_research_time = res_comp_item.time_seconds;
            weap_line.weapons = {};
            weap_line.weapons = [weap_id];
            WeapLines[weapSubClass] = weap_line;  
            WeapLines_array.push(weap_line);
        }else
        {
            weap_line.min_research_time = Math.min(weap_line.min_research_time, res_comp_item.time_seconds);
            weap_line.weapons.push(weap_id);
        }
    }

    WeapLines_array.sort(function (elm1, elm2) {
        return elm1.min_research_time - elm2.min_research_time;
    });
    for(var i=0; i < WeapLines_array.length; i++)
    {
        var elem = DrawSection_type1_html($('#' + container_id).attr('id'), WeapLines_array[i].weaponSubClass);
        DrawWeapons(elem.attr('id'), WeapLines_array[i].weapons,null );
    }
}

var VTOL_cols = [
    {
        label: "<span lang='en'>VTOL Ammo</span><span lang='ru'>Кол-во снарядов</span>", name: "ammo", width: 45, formatter: function (cellvalue, options, rowObject) {
            return CalcVTOL_numshots(rowObject);
        }, sorttype: "int"
    },

    ]

var listed_weapons = {};
function DrawWeapons(container_id, weap_id_list, weapon_filter_function, additional_columns) {
    /* prepare list of structures depending on function parameters */
    if (additional_columns == null || additional_columns == undefined) {
        additional_columns = [];
    }
    var grid_data = [];
    if (weap_id_list == null) {
        for (var weap_id in Weapons.loaded_data_hash) {
            if (weapon_filter_function(Weapons.loaded_data_hash[weap_id])) {
                var weapon = Weapons.loaded_data_hash[weap_id];
                var weapon_upgraded = jQuery.parseJSON(JSON.stringify(Upgrades[player].Weapon[weapon.index_of_datarow]))
                weapon_upgraded.base = weapon;
                //var weap_c = {};
                //weap_c.base = {};
                //CalculateWeaponStats_AddToObjects(player, weap, weap_c, weap_c.base, weap_c, false);
                //grid_data.push(weap_c);
                grid_data.push(weapon_upgraded);
            }
        }
    } else {
        for (var i = 0; i < weap_id_list.length; i++) {
            var weapon = Weapons.loaded_data_hash[weap_id_list[i]];
            var weapon_upgraded = jQuery.parseJSON(JSON.stringify(Upgrades[player].Weapon[weapon.index_of_datarow]))
            weapon_upgraded.base = weapon;
            grid_data.push(weapon_upgraded);
        }
    }

    /* calculate parameters of weapons */
    for (var i = 0; i < grid_data.length; i++) {

        /* save listed weapons */
        listed_weapons[grid_data[i].grid_id] = 1;
    }

    grid_data.sort(function (a, b) {
        return a.minResearchTime - b.minResearchTime;
    });


    var table_id = container_id + '_table';
    var html = '<table id="' + table_id + '" ></table>';
    $('#' + container_id).append('<div style="margin-top:5px">' + html + '</div>');
    var grid = $('#' + table_id);

    grid.jqGrid
    ({
        datatype: "local",
        data: grid_data,
        rowNum: grid_data.length,
        height: 'auto',
        colModel:
        [
            { label: "", name: "grid_id", key: true, hidden: true },
            {
                label: " ",
                name: 'pic',
                width: '65px',
                sortable: false,
                search: false,
                formatter: function (cellvalue, options, rowObject) {
                    return '<a href="javascript:openWeaponDetails(\'' + rowObject.grid_id + '\')">' + Weapons.GetIconHtml_Function(rowObject) + '</a>';
                },
            },
            {
                label: " ", name: "name",
                formatter: function (cellvalue, options, rowObject) {
                    return '<a href="javascript:openWeaponDetails(\'' + rowObject.grid_id + '\')">' + cellvalue + '</a>';
                },
            },
            {
                label: Translate("Range"), name: "longRange", sorttype: "int", formatter: function (cellvalue, options, rowObject) {
                    return PropDescr("longRange_tiles").format_str(cellvalue);
                }, width: 40
            },
            {
                label: Translate("Damage"), sortable: false,
                formatter: function (cellvalue, options, rowObject) {
                    return WeaponDamage_htmlCell(rowObject);
                },
                width: 130
            },
            {
            label: Translate("Rate of Fire"), sortable: false,
                formatter: function (cellvalue, options, rowObject) { return Weapon_ShotsPerMinute(rowObject).toFixed(1) + " /" + Translate("min"); }, width: 78,//
            },
            {
                label: "<span lang='en'>HP</span><span lang='ru'>Очки жизни (HP)</span>", sortable: false,
                formatter: function (cellvalue, options, rowObject) {
                    return rowObject.hitpoints;
                },
                width: 70,
            },
            {
                label: Translate("Price"), name: "buildPower", width: 45, formatter: function (cellvalue, options, rowObject) {
                    return '<label style="color:#116611">$' + cellvalue + '</label>';
                }, sorttype: "int"
            },
            {
                label: "<span lang='en'><label title='Minimum time of research'>Research</label></span><span lang='ru'><label title='Минимальное время для исследования'>Исследование</label></span>",
                name: "minResearchTime",
                width: 80,
                formatter: function (cellvalue, options, rowObject) {
                    var res_comp_item = ResearchedComponents[player_all_researched][rowObject.grid_id];
                    if (res_comp_item != undefined) {
                        var value = res_comp_item.time_seconds;
                        if (value < 3600) {
                            return value.toMMSS();
                        } else {
                            return value.toHHMMSS();
                        }
                    }
                    return ' - ';
                },
            },
            {
                label: "<span lang='en'><label title='Propulsion damage modifiers (Class)'>Class</label></span><span lang='ru'><label title='Модификаторы урона по типам ходовой (Тип)'>Тип</label></span>",
                width: 70,
                name: "weaponEffect",
                formatter: function (cellvalue, options, rowObject) {
                    return '<a href="javascript:OpenDamageModifiers()" style="font-size:0.8em;" title="' + weap_modifiers_str[cellvalue] + '" >' + cellvalue + '</a>';//<span class="ui-icon ui-icon-extlink" style="display:inline-block"></span>
                },
            },
        ].concat(additional_columns).concat([
                        {
                            label: "<span lang='en'>Abilities</span><span lang='ru'>Способности</span>",
                            width: 300,
                            formatter: function (cellvalue, options, rowObject) {
                                var abils = Weapon_GetAbilities(rowObject);
                                var res_html = "<ul style='margin:2px; font-size:0.9em'>";
                                for (var ability in abils) {
                                    if (abils[ability]) {
                                        var des = Abilities_Description(ability);
                                        if (!des.designer_only_ability) {
                                            res_html += '<li><i>' + des.name + '</i></li>';
                                        }
                                    }
                                }
                                return '</ul>' + res_html;
                            },
                        },
                        ]),
        onSelectRow: function (rowid) {
        },
        loadonce: true,
        ignoreCase: true, //make search case insensitive
    });


}


function show_nonres() {
    if ($('#nonres_weaps').length == 0) {
        sect = $('<div id="nonres_weaps"></div>');
        $('#loadable_weapon_lists').append(sect);
        var weap_sect = DrawSection_type2_html(sect.attr('id'), "<span lang='en'>Unavailable weapons</span><span lang='ru'>Недоступные орудия</span>");
        var sect2 = DrawSection_type1_html(weap_sect.attr('id'), "");
        DoResearch(res_time, player, function () {
            {
                var func = function (weapon) {
                    return listed_weapons[weapon.grid_id] == undefined;
                };
                DrawWeapons(sect2.attr('id'), null, func);
            }
        });
    }
    document.getElementById("nonres_weaps").scrollIntoView();
}

function showAA() {
    if ($('#aa_weaps').length == 0) {
        sect = $('<div id="aa_weaps"></div>');
        $('#loadable_weapon_lists').append(sect);
        var aa_weap = DrawSection_type2_html(sect.attr('id'), "<span lang='en'>Anti-Air Weapons</span><span lang='ru'>ПВО (противовоздушные орудия)</span>");
        var sect2 = DrawSection_type1_html(aa_weap.attr('id'), "");
        sect2.append("<span lang='en'>Weapons which can attack only flying <i>VTOL units</i>. This weapons cannot hit ground objects.</span><span lang='ru'>Орудия, которые могут атаковать только воздушные цели. Такие орудия не могут поражать наземные цели.</span>");
        DoResearch(res_time, player, function () {
            {
                var func = function (weapon) {
                    if (!IsAviableWeapon(weapon)) return false;
                    var abils = Weapon_GetAbilities(weapon);
                    if (!(abils.CanHitVtols && abils.CannotHitGround)) {
                        return false;
                    }
                    return true;
                };
                DrawWeapons(sect2.attr('id'), null, func);
            }
        });
    }
    document.getElementById("aa_weaps").scrollIntoView();
}

function showArty() {
    if ($('#arty_weaps').length == 0) {
        sect = $('<div id="arty_weaps"></div>');
        $('#loadable_weapon_lists').append(sect);
        var weap_sect = DrawSection_type2_html(sect.attr('id'), "<span lang='en'>Artillery</span><span lang='ru'>Артиллерия</span>");
        var sect2 = DrawSection_type1_html(weap_sect.attr('id'), "");
        DoResearch(res_time, player, function () {
            {
                var func = function (weapon) {
                    if (!IsAviableWeapon(weapon)) return false;
                    var abils = Weapon_GetAbilities(weapon);
                    if (!abils.Indirect || abils.CannotHitGround) {
                        return false;
                    }
                    return true;
                };
                DrawWeapons(sect2.attr('id'), null, func);
            }
        });
    }
    document.getElementById("arty_weaps").scrollIntoView();
}

function showAPWeaps() {
    if ($('#AP_weaps').length == 0) {
        sect = $('<div id="AP_weaps"></div>');
        $('#loadable_weapon_lists').append(sect);
        var weap_sect = DrawSection_type2_html(sect.attr('id'), "<span lang='en'>Anti-cyborg Weapons</span><span lang='ru'>Противопехотные орудия (против киборгов)</span>");
        var sect2 = DrawSection_type1_html(weap_sect.attr('id'), "");
        DoResearch(res_time, player, function () {
            {
                var func = function (weapon) {
                    if (!IsAviableWeapon(weapon)) return false;
                    var abils = Weapon_GetAbilities(weapon);
                    if (abils.CannotHitGround || weapon.weaponEffect != "ANTI PERSONNEL") {
                        return false;
                    }
                    return true;
                };
                DrawWeapons(sect2.attr('id'), null, func);
            }
        });
    }
    document.getElementById("AP_weaps").scrollIntoView();
}

function showAntiDef() {
    if ($('#AntiDef_weaps').length == 0) {
        sect = $('<div id="AntiDef_weaps"></div>');
        $('#loadable_weapon_lists').append(sect);
        var weap_sect = DrawSection_type2_html(sect.attr('id'), "<span lang='en'>Anti-defense weapons</span><span lang='ru'>Орудия для разрушения защитных сооружений</span>");
        var sect2 = DrawSection_type1_html(weap_sect.attr('id'), "");
        DoResearch(res_time, player, function () {
            {
                var func = function (weapon) {
                    if (!IsAviableWeapon(weapon)) return false;
                    var abils = Weapon_GetAbilities(weapon);
                    if (abils.CannotHitGround || weapon.weaponEffect != "BUNKER BUSTER") {
                        return false;
                    }
                    return true;
                };
                DrawWeapons(sect2.attr('id'), null, func);
            }
        });
    }
    document.getElementById("AntiDef_weaps").scrollIntoView();
}

function showOverpowred() {
    if ($('#OP_weaps').length == 0) {
        sect = $('<div id="OP_weaps"></div>');
        $('#loadable_weapon_lists').append(sect);
        var weap_sect = DrawSection_type2_html(sect.attr('id'), "<span lang='en'>Weapons which are overpowered in Multiplayer</span><span lang='ru'>Орудия, которые можно считать неслабансированно сильными в Мультиплеере</span>");
        DoResearch(res_time, player, function () {
            {
                var low_sect = DrawSection_type1_html(weap_sect.attr('id'), "<span lang='en'>Overpowered weapons at low-oil games</span><span lang='ru'>Несбалансированные орудия в играх low-oil</span>");
                var op_list1 = ["MG4ROTARYMk1"];
                DrawWeapons(low_sect.attr('id'), op_list1);

                var hi_sect = DrawSection_type1_html(weap_sect.attr('id'), "<span lang='en'>Overpowered weapons at high-oil games</span><span lang='ru'>Несбалансированные орудия в играх high-oil</span>");
                var op_list2 = ["Bomb4-VTOL-HvyINC", "Bomb5-VTOL-Plasmite", "Howitzer150Mk1", "Mortar-Incenediary"];
                DrawWeapons(hi_sect.attr('id'), op_list2);
            }
        });
    }
    document.getElementById("OP_weaps").scrollIntoView();
}

function openWeaponDetails(weapon_id) {
    DrawDetailsTab_Init(weapon_id);
    url_pushState('?details_id=' + weapon_id);
}


function DrawDetailsTab_Init(weapon_id) {
    $("#tabs_left").tabs("option", "active", 1);
    var res_time = 600;

    DrawResearchSlider("research_slider_details",
        res_time,
        function (value) {

            DoResearch(value, player, function () {
                if (weapon_id == undefined) {
                    weapon_id = getUrlVars()["details_id"]; //in case when tab was opened without selected weapon
                }
                DrawWeaponDetailsParameters(weapon_id);
            });
        });

    if (weapon_id != undefined) {
        DoResearch(res_time, player, function () {
            DrawWeaponDetailsParameters(weapon_id);
            DrawWeaponStaticData(weapon_id);
        });
    }

    $("#select_weapon_button").button({
        icons: {
            primary: "ui-icon-triangle-1-s",
        }
    }).click(function (event) {
        event.preventDefault();
        ShowSeletDialog_forDataObject(Weapons, null, function (weap_id_new) {
            DrawWeaponDetailsParameters(weap_id_new);
            DrawWeaponStaticData(weap_id_new);
            url_pushState('?details_id=' + weap_id_new);
        });
    });
}

function DrawWeaponDetailsParameters(weap_id) {
    var weapon = Weapons.loaded_data_hash[weap_id];

    if (weapon != undefined) {
        $("#weapon_detail_data_container").show();
        scrollToId('#tabs_left');
    }

    var weapon_upgraded = GetTurretUpgrade(player, weap_id, false)[weapon.index_of_datarow];

    $("#select_weapon_button").button({
        icons: {
            primary: "ui-icon-triangle-1-s",
        }
    }).click(function (event) {
        event.preventDefault();
        ShowSeletDialog_forDataObject(Weapons, weap_id, function (weap_id_new) {
            DrawWeaponDetailsParameters(weap_id_new);
            DrawWeaponStaticData(weap_id_new);
            url_pushState('?details_id=' + weap_id_new);
        });
    });

    $("#weapon_icon").html(Weapons.GetIconHtml_Function(weapon));
    $("#weapon_name_label").text(weapon.name);
    $("#abilities_container").html(Form_Weapon_Abilities_html(weapon));
    
    /* Draw parameters of weapon */
    $('#weapon_details_details').html('<div id="weapon_details_details_container"></div>');
    grid_data = [];
    {
        var row = new Object;
        row.name = Translate('Price');
        row.base = PropDescr("price").format_html(weapon.buildPower);
        row.upgraded = PropDescr("price").format_html(weapon_upgraded.buildPower);
        row.group = '';
        row.descr = Translate('Price added to total price of tank design.');
        grid_data.push(row);
    }
    {
        var abils = Weapon_GetAbilities(weapon);
        var fact_build_points;
        var fact_build_points_upgraded;

        if (abils.VTOLWeapon) {
            fact_build_points = Structures.loaded_data_hash['A0VTolFactory1'].productionPoints; // per second
            fact_build_points_upgraded = Upgrades[player].Building[Structures.loaded_data_hash['A0VTolFactory1'].index_of_datarow].productionPoints; // per second
        } else if (abils.CyborgWeapon) {
            fact_build_points = Structures.loaded_data_hash['A0CyborgFactory'].productionPoints; // per second
            fact_build_points_upgraded = Upgrades[player].Building[Structures.loaded_data_hash['A0CyborgFactory'].index_of_datarow].productionPoints; // per second
        } else {
            fact_build_points = Structures.loaded_data_hash['A0LightFactory'].productionPoints; // per second
            fact_build_points_upgraded = Upgrades[player].Building[Structures.loaded_data_hash['A0LightFactory'].index_of_datarow].productionPoints; // per second
        }

        var row = new Object;
        row.name = Translate('Build Time (factory with 1 module)');
        row.base = (weapon.buildPower / fact_build_points).toMMSS();
        row.upgraded = (weapon_upgraded.buildPower / fact_build_points_upgraded).toMMSS();
        row.group = '';
        row.descr = Translate('This time adds to total build time of tank design.');
        grid_data.push(row);
    }
    {
        var row = new Object;
        row.name = Translate('Weight');
        row.base = weapon.weight;
        row.upgraded = weapon_upgraded.weight;
        row.group = '';
        row.descr = Translate('This weight adds to total weight of tank design.');
        grid_data.push(row);
    }
    {
        var row = new Object;
        row.name = Translate('Hit Points');
        row.base = weapon.hitpoints;
        row.upgraded = weapon_upgraded.hitpoints;
        row.group = '';
        row.descr = Translate('Hit points are added to total hitpoint of tank design. Note: weapon hitpoints become increased with each composite alloys upgrade.');
        grid_data.push(row);
    }
    grid_data = grid_data.concat(CalcWeaponRelatedParameters(weapon, weapon_upgraded));

    DrawComponentDetailsGrid(grid_data, "weapon_details_details_container");

    Designer_Draw_DPSTable("dps_table_container", [weapon_upgraded], player);
}

function DrawWeaponStaticData(weapon_id) {

    var weapon = Weapons.loaded_data_hash[weapon_id];

    /* Show auto-generated description of weapon */
    var auto_descr = ('[' + Translate(weapon.weaponClass.toLowerCase()) + ' ' + Translate(weapon.weaponEffect.toLowerCase()) + ' ' + Translate(weapon.weaponSubClass.toLowerCase() ) + ']').toLowerCase();
    var struc_weapon_descr = "";

    var armed_strucs = [];
    for (var is in Structures.loaded_data) {
        var struc = Structures.loaded_data[is];
        if (struc.weapons != undefined && can_research(struc.grid_id)) {
            if (struc.weapons.indexOf(weapon_id) >= 0) {
                armed_strucs.push(struc);
            }
        }
    }

    if (armed_strucs.length > 0) {
        if (can_research(weapon_id)) {
            struc_weapon_descr += '<p><span lang="en">List of defensive structures armed with this weapon:</span><span lang="ru">Список защитных построек, на которых установлено данное Орудие:</span></p>';
        }else{
            struc_weapon_descr += '<p><span lang="en">This weapon can not be researched, but you can get <b>defensive structures</b> armed with this weapon.</span><span lang="ru">Данное Орудие не может быть исследовано, но при этом оно используется на следующих защитных постройках:</span></p>';
        }
        
        struc_weapon_descr += '<ul>';
        for (var is in armed_strucs) {
            var struc = armed_strucs[is];
            struc_weapon_descr += '<li><a href="structure.html?details_id=' + struc.grid_id + '">' + struc.name + '</a></li>';
        }
        struc_weapon_descr += '</ul>';
        auto_descr += struc_weapon_descr;
    }


    $('#details_description').html(auto_descr);

    /* Show button "Overview research path" */
    var res_comp_row = ResearchedComponents[player_all_researched][weapon_id];
    if (res_comp_row != undefined) {
        var research = Researches.loaded_data_hash[res_comp_row.research_id];
        var res_path_button_html = '<br/> <span lang="en">Research required:</span><span lang="ru">Требуемое исследование:</span><a href="#" id="show_resdetails_button_span">' + research.name + '</a><button type="button" id="show_respath_button_span"><span lang="en">Overview research path</span><span lang="ru">Просмотр требуемых исследований</span></button>'
        $('#details_description').append(res_path_button_html);

        $('#show_resdetails_button_span').attr("href", "Research.html?details_id=" + research.grid_id)
        $('#show_respath_button_span').button().click(null, function (event) {
            event.preventDefault();
            window.open("Research.html?tree=1&component_id=" + weapon_id);
        }).css("font-size","0.8em").css("margin-left","50px");
    }


    /* Draw Damage modifiers table */
    DrawWeaponPropulsionModifiers("weapon_details_damage_modifiers", weapon_id);
    /* Draw Research Path */
    var res_path_data = GetResearchPath_SubTree(weapon_id, player_all_researched, 5);
    DrawResearchPath_Tree("research_path_container", res_path_data);

    /* Draw damage upgrades table */
    DrawWeaponUpgradeTable("damage_upgrades_container", weapon_id, "damage");
    DrawWeaponUpgradeTable("rof_upgrades_container", weapon_id, "firePause");
}

    </script>
</head>
<body>
    <table class="ui-widget ui-corner-all">
        <tr>
            <td id="page_header">

            </td>
        </tr>
        <tr>
            <td id="page_caption" data-caption="<span lang='en'>Weapons Guide</span><span lang='ru'>Орудия - Руководство по орудиям</span>">

            </td>
        </tr>
    <tr>
        <td style="width:100%;vertical-align:top">
            <div id="tabs_left" >
                <ul>
                    <li><a href="#left-tabs-1"><span lang="en">Weapons Guide</span><span lang="ru">Орудия</span></a></li>
                    <li><a href="#left-tabs-detail"><span lang="en">Weapon detail</span><span lang="ru">Детальная информация про орудие</span></a></li>
                    <li><a href="#left-tabs-2"><span lang="en">Damage Modifiers</span><span lang="ru">Модификаторы урона / сопротивления</span></a></li>
                </ul>
                <div id="left-tabs-1">
                    <div class="ui-accordion ui-widget ui-helper-reset" role="tablist" >
	                    <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                            <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                           <span lang="en">Introduction</span><span lang="ru">Введение</span>
	                    </h3>
                        <div id="Div2" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">

                        <span lang="en">
Weapons are a very important part of tank design. Weapon types are grouped into Artillery, Anti-Tank and All-rounder with weapon damage being greatly dependent on enemy propulsion type. 
See <a href="javascript:OpenDamageModifiers()">Weapon damage modifiers</a> for exact values.<br />
Each weapon can have two damage types: <span style="color:blue">kinetic</span> or <span style="color:red">thermal</span>.   
                        </span>
                        <span lang="ru">
Орудие это главное в дизайне юнитов. В игре есть несколько типов орудий: артиллерия, противотанковые орудия, противопехотные орудия, орудия общего назначения(All-rounder). Урон по цели сильно зависит от типа ходовой цели. Например, урон пулеметов по киборгам в несколько раз выше, чем урон по гусеничным танкам.
Смотрите <a href="javascript:OpenDamageModifiers()">Модификаторы урона по типам ходовой</a><br />
Каждое орудие может иметь один из следующих видов атаки: <span style="color:blue">кинетическая</span> или <span style="color:red">огненная</span>.   
                        </span>
                         
                        </div>
                    </div>
                    <table>
                        <tr>
                            <td>
                                <ul  class="MyStyledLinkMenu" style="display:inline-block">
                                    <li><a href="#tank_weapons"><span lang="en">Tank Weapons</span><span lang="ru">Танковые орудия</span></a></li>
                                    <li><a href="#cyborg_weapons"><span lang="en">Cyborg Weapons</span><span lang="ru">Орудия киборгов</span></a></li>
                                    <li><a href="#vtol_weapons"><span lang="en">VTOL Weapons</span><span lang="ru">Орудия СВВП (VTOL)</span></a></li>
                                    <li><a href="#other_weapons"><span lang="en">Other Weapons</span><span lang="ru">Другие орудия</span></a></li>
                                    <li><a href="javascript:show_nonres()"><span lang="en">Unavailable Weapons</span><span lang="ru">Недоступные в игре орудия</span></a></li>
                                </ul>
                            </td>
                            <td>
                                <ul class="MyStyledLinkMenu" style="display:inline-block">
                                    <li><a href="javascript:showAA()">A<span lang="en">nti-Air (AA) Weapons</span><span lang="ru">ПВО</span></a></li>
                                    <li><a href="javascript:showArty()"><span lang="en">Artillery</span><span lang="ru">Артиллерия</span></a></li>
                                    <li><a href="javascript:showAPWeaps()"><span lang="en">Anti-Cyborg Weapons</span><span lang="ru">Противопехотные орудия (против киборгов)</span></a></li>
                                    <li><a href="javascript:showAntiDef()"><span lang="en">Anti-defense weapons</span><span lang="ru">Орудия для разрушения укреплений</span></a></li>
                                    <li><a href="javascript:showOverpowred()"><span lang="en">Overpowered Weapons</span><span lang="ru">Несбалансированные орудия</span></a></li>
                                </ul>
                            </td>
                            <td style="width:40%">
                                <div  class="ui-widget ui-corner-all" style="padding: -2px; width:500px; display:inline-block; float:right">
                                    <div id="research_slider">

                                    </div>
                                    <label style="font-size:0.9em; color:gray;float:right"><span lang="en">Use slider to see numeric values for different states of research.</span><span lang="ru">Используйте ползунок чтобы смотреть параметры для различных уровней технологий.</span></label>
                                </div>
                            </td>
                        </tr>
                    </table>


                    <div id="tank_weapons"></div>
                    <div id="cyborg_weapons"></div>
                    <div id="vtol_weapons"></div>
                    <div id="other_weapons"></div>
                    <div id="loadable_weapon_lists"></div>
                </div>
                <div id="left-tabs-2">

                </div>
                <div id="left-tabs-detail">
                    <table style="width:100%">
                        <tr>
                            <td>
                                <div id="selected_weapon_header">
                                    <table>
                                        <tr>
                                            <td>
                                                <span style="float:left" id="weapon_icon"></span>
                                            </td>
                                            <td>
                                                <span id="weapon_name_label" style="font-size:1.2em; float:left">[...]</span>
                                            </td>
                                        </tr>
                                    </table>
                                </div>
                            </td>
                            <td>
                                <span lang="en">You can see details for any weapon, just select another weapon. </span><span lang="ru">Вы можете просмотреть детальную информацию для любого орудия. Просто выберите другое орудие.</span><br />
                                <div style="width:100%;text-align:center">
                                    <button id="select_weapon_button" type="button" style="display:inline-block"><span lang="en">Select Weapon...</span><span lang="ru">Выбор орудия...</span></button>
                                </div>
                                
                            </td>
                        </tr>
                        <tr>
                            <td colspan="2">
                                <table style="width:100%">
                                    <tr>
                                        <td style="width:65%">
                                            <div class="ui-accordion ui-widget ui-helper-reset" role="tablist" style="margin-top:20px">
	                                            <h3 style="text-align:left" class="ui-accordion-header ui-helper-reset ui-state-default ui-accordion-icons ui-accordion-header-active ui-state-active ui-corner-top">
                                                    <span class="ui-accordion-header-icon ui-icon ui-icon-triangle-1-s" style="float:left;"></span>
                                                    <span lang="en">Description</span><span lang="ru">Описание</span>
	                                            </h3>
                                                <div id="details_description" class="ui-accordion-content ui-helper-reset ui-widget-content ui-corner-bottom ui-accordion-content-active" style="display: block; text-align:left">
                                                </div>
                                            </div>
                                        </td>
                                        <td style="width:35%">
                                            <div  class="ui-widget ui-corner-all" style="padding: -2px; width:500px; display:inline-block;">
                                            <div id="research_slider_details">

                                            </div>
                                            <label style="font-size:0.9em; color:gray;"><span lang="en">Use slider to see numeric values for different states of research.</span><span lang="ru">Используйте ползунок чтобы смотреть параметры для различных уровней технологий.</span></label>
                                            </div>
                                        </td>
                                    </tr>
                                </table>
                            </td>
                        </tr>
                        <tr id="weapon_detail_data_container" style="display:none">
                            <td style="vertical-align:top; width:50%">
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="main_parameters_container"></div>

                                <div class="ui-widget-header ui-corner-top" style="padding:2px"><span lang="en">Detail Parameters</span><span lang="ru">Детальные параметры</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="weapon_details_details"></div>
                                <div class="ui-widget-header ui-corner-top" style="padding:2px"><span lang="en">Damage modifiers</span><span lang="ru">Модификаторы урона</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="weapon_details_damage_modifiers"></div>
                                <div class="ui-widget-header ui-corner-top" style="padding:2px"><span lang="en">DPS stats (Damage per second)</span><span lang="ru">ДПС (Урон в секунду)</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="dps_table_container"></div>
                            </td>
                            <td style="vertical-align:top; width:50%">
                                <div class="ui-widget-header ui-corner-top" style="padding:2px;"><span lang="en">Abilities</span><span lang="ru">Способности</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="abilities_container"></div>

                                <div class="ui-widget-header ui-corner-top" style="padding:2px"><span lang="en">Damage Upgrades</span><span lang="ru">Улучшения урона</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="damage_upgrades_container"></div>

                                <div class="ui-widget-header ui-corner-top" style="padding:2px"><span lang="en">Rate of Fire Upgrades</span><span lang="ru">Улучшения скорострельности</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="rof_upgrades_container"></div>

                                <div class="ui-widget-header ui-corner-top" style="padding:2px"><span lang="en">Research</span><span lang="ru">Исследования</span></div>
                                <div class="ui-widget-content ui-corner-bottom" style="padding:2px" id="research_path_container"></div>

                            </td>
                        </tr>
                    </table>
                </div>
            </div>
        </td>
    </tr>
    </table>

    <div id="modifiers_container" style="display:none">

    </div>

        <label style="float:right; margin-right:100px; color:gray">made by crab_ ©</label>
</body>
</html>
